# mapbox-sample

3D 地図ライブラリ Mapbox による東京緑化ポテンシャルマップの検証プロトタイプ

## 環境構築

パッケージのインストール

```sh
pnpm i
```

起動

```sh
pnpm dev
```

## 検証・調査したこと

### 3D モデルの配置と表現方法

都市緑化の可視化において、建物以外の 3D 要素をどのように表現するかを検証した。簡易的なポリゴンは GeoJSON や MVT で表現可能だが、植物のような複雑な形状には `.glb` 形式が必要であることが分かった。実際に Blender の Python スクリプティング機能を使って樹木モデルを作成し、東京タワー周辺に配置することに成功した。

### データの差分読み込みによる最適化

大規模なデータを扱う際のパフォーマンス向上のため、以下の手法を調査した。

| 通常版                    | 差分読み込み版        | 用途                   |
| ------------------------- | --------------------- | ---------------------- |
| `.geojson` (GeoJSONLayer) | `.pbf` (MVTLayer)     | 簡易的なポリゴンの配置 |
| `.glb` (ScenegraphLayer)  | `.b3dm` (Tile3DLayer) | 複雑な 3D モデルの配置 |

品川区や東京都全体への拡張を見据え、.b3dm 形式による 3D タイル化が有効であると考えられる。実際の差分読み込みの実装は今後の課題である。

### 建物データとの連携

Mapbox の建物ベクタータイルが持つ Feature ID を活用し、クリック時のポップアップに建物固有の緑化ポテンシャル情報を表示する仕組みを実装した。これにより、衛星画像解析結果などの外部データを建物ごとに紐付けることが可能である。

### 日照シミュレーションの制限

Mapbox Standard のライティング機能では `dawn` 、`day` 、`dusk` 、`night` の 4 つのプリセットのみが利用可能で、時間帯や季節による詳細な影の変化を表現するには制限があることが判明した。より高度な日照シミュレーションが必要な場合は、他のライブラリとの併用を検討する必要がある。
